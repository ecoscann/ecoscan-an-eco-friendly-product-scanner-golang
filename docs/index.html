<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ecoScanAi</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" xintegrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Barcode Scanner Library -->
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    
    <!-- Custom Styles and Tailwind Configuration -->
    <style>
        /* Inter Font */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7fafc; /* Light gray background */
        }

        /* Custom Theme Colors */
        .bg-leaf-green { background-color: #4CAF50; }
        .text-leaf-green { color: #4CAF50; }
        .border-leaf-green { border-color: #4CAF50; }
        .hover\:bg-leaf-green-dark:hover { background-color: #45a049; }
        .bg-dark-mode { background-color: #1a202c; }
        .text-dark-mode { color: #1a202c; }

        /* Custom Leaf SVG Background Pattern */
        .leaf-pattern {
            background-color: #ffffff;
            background-image: 
                radial-gradient(#4CAF50 1px, transparent 1px),
                radial-gradient(#4CAF50 1px, #ffffff 1px);
            background-size: 40px 40px;
            background-position: 0 0, 20px 20px;
            opacity: 0.05;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: -1;
        }

        /* Scanner Box Styling */
        #reader {
            width: 100%;
            max-width: 500px;
            border: 4px dashed #4CAF50;
            border-radius: 16px;
            overflow: hidden;
            position: relative;
        }

        #reader__dashboard_section_csr button {
            background-color: #4CAF50;
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: 500;
        }

        /* Modal Styling */
        .modal {
            transition: opacity 0.25s ease;
        }
        .modal-content {
            transition: transform 0.25s ease;
        }

        /* Form Input Styling */
        .form-input {
            @apply w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-leaf-green focus:border-transparent transition duration-200;
        }
        
        /* Button Styling */
        .btn {
            @apply px-6 py-3 rounded-lg font-bold text-white shadow-md transition duration-200 transform hover:scale-105;
        }
        .btn-green {
            @apply bg-leaf-green hover:bg-leaf-green-dark;
        }
        .btn-dark {
            @apply bg-dark-mode hover:bg-gray-800;
        }
        .btn-light {
            @apply bg-white text-dark-mode border border-gray-300 hover:bg-gray-100;
        }

        /* Loading Spinner */
        .spinner {
            border-top-color: #4CAF50;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Hide scrollbar for product modal alternatives */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>

<body class="bg-gray-50 text-dark-mode">

    <!-- Global Loading Spinner -->
    <div id="loading-spinner" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[999]">
        <div class="spinner w-16 h-16 border-4 border-gray-200 border-t-leaf-green rounded-full"></div>
    </div>

    <!-- Global Message Modal -->
    <div id="message-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-[998]">
        <div class="modal-content bg-white p-6 rounded-lg shadow-xl w-11/12 max-w-md text-center">
            <p id="message-text" class="text-lg mb-4"></p>
            <button id="message-close-btn" class="btn btn-green">Close</button>
        </div>
    </div>

    <!-- Product Details Modal -->
    <div id="product-modal" class="modal hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-[997] p-4">
        <div class="modal-content bg-white rounded-2xl shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto no-scrollbar transform scale-95">
            <div class="p-6 relative">
                <button id="product-modal-close" class="absolute top-4 right-4 text-gray-500 hover:text-gray-900">
                    <i class="fas fa-times fa-lg"></i>
                </button>
                
                <!-- Product Main Info -->
                <div id="product-modal-content" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Left Column: Image & Basic Info -->
                    <div>
                        <img id="product-img" src="https://placehold.co/400x400/eeeeee/cccccc?text=Product" alt="Product Image" class="w-full h-64 object-cover rounded-lg mb-4">
                        <h2 id="product-name" class="text-2xl font-bold mb-1">Product Name</h2>
                        <p id="product-brand" class="text-lg text-gray-600 mb-4">Brand Name</p>
                        <h2 id="product-name" class="text-3xl font-bold mb-1"></h2>
                         <p id="product-brand" class="text-lg text-gray-500 mb-2"></p>
                        <p id="product-price" class="text-3xl font-bold text-green-600 mb-4"></p>
                        <p class="text-sm text-gray-500">Barcode: <span id="product-barcode"></span></p>
                    </div>

                    <!-- Right Column: Score & Details -->
                    <div>
                        <h3 class="text-lg font-semibold mb-2">Eco Score</h3>
                        <div class="flex items-center gap-4 mb-4">
                            <div id="product-score" class="text-6xl font-bold text-leaf-green">85</div>
                            <div id="product-score-rating" class="text-xl font-semibold">Good</div>
                        </div>
                        
                        <div class="space-y-3">
                            <h4 class="font-semibold text-md">Score Breakdown:</h4>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-700"><i class="fas fa-box-open mr-2 text-leaf-green"></i>Packaging</span>
                                <span id="product-packaging" class="font-bold"></span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-700"><i class="fas fa-truck mr-2 text-leaf-green"></i>Transport</span>
                                <span id="product-transport" class="font-bold"></span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-700"><i class="fas fa-recycle mr-2 text-leaf-green"></i>Disposal</span>
                                <span id="product-disposal" class="font-bold"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Alternatives Section -->
                <div id="product-alternatives-container" class="mt-8 pt-6 border-t border-gray-200">
                    <h3 class="text-xl font-semibold mb-4">Better Alternatives</h3>
                    <div id="product-alternatives-list" class="flex overflow-x-auto gap-4 pb-4 no-scrollbar">
                        <!-- Alternative items will be injected here -->
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Header / Navigation -->
    <header id="app-header" class="bg-white shadow-md sticky top-0 z-50">
        <nav class="container mx-auto px-4 py-4 flex justify-between items-center">
            <!-- Logo -->
            <a href="#" class="nav-link text-2xl font-extrabold text-dark-mode flex items-center" data-page="home">
                <i class="fas fa-leaf mr-2 text-leaf-green"></i>
                ecoScan<span class="text-leaf-green">Ai</span>
            </a>
            
            <!-- Mobile Menu Button -->
            <button id="mobile-menu-btn" class="md:hidden text-2xl">
                <i class="fas fa-bars"></i>
            </button>

            <!-- Desktop Nav Links -->
            <div class="hidden md:flex items-center space-x-6">
                <a href="#" class="nav-link text-gray-700 hover:text-leaf-green font-medium" data-page="home">Home</a>
                <a href="#" class="nav-link text-gray-700 hover:text-leaf-green font-medium" data-page="scoring">Scoring</a>
                <a href="#" class="nav-link text-gray-700 hover:text-leaf-green font-medium" data-page="about">About Us</a>

                <!-- Auth Links (Logged Out) -->
                <div id="auth-links" class="flex items-center space-x-3">
                    <a href="#" class="nav-link px-4 py-2 rounded-lg text-dark-mode font-medium hover:bg-gray-100" data-page="login">Login</a>
                    <a href="#" class="nav-link btn btn-green" data-page="register">Create Account</a>
                </div>

                <!-- User Links (Logged In) -->
                <div id="user-links" class="hidden flex items-center space-x-4">
                    <a href="#" class="nav-link text-gray-700 hover:text-leaf-green font-medium" data-page="request-product">Request Product</a>
                    <a href="#" class="nav-link px-4 py-2 rounded-lg font-medium bg-leaf-green text-white hover:bg-leaf-green-dark" data-page="dashboard">Dashboard</a>
                    <a href="#" id="logout-btn" class="nav-link text-gray-700 hover:text-leaf-green font-medium" data-page="home">Logout</a>
                </div>
            </div>
        </nav>
        
        <!-- Mobile Menu (Dropdown) -->
        <div id="mobile-menu" class="hidden md:hidden bg-white shadow-lg pb-4">
            <a href="#" class="nav-link block px-5 py-3 text-gray-700 hover:bg-gray-100" data-page="home">Home</a>
            <a href="#" class="nav-link block px-5 py-3 text-gray-700 hover:bg-gray-100" data-page="scoring">Scoring</a>
            <a href="#" class="nav-link block px-5 py-3 text-gray-700 hover:bg-gray-100" data-page="about">About Us</a>

            <!-- Mobile Auth Links -->
            <div id="mobile-auth-links" class="px-5 pt-3 border-t border-gray-200 space-y-3">
                <a href="#" class="nav-link block w-full text-center px-4 py-2 rounded-lg text-dark-mode font-medium bg-gray-100 hover:bg-gray-200" data-page="login">Login</a>
                <a href="#" class="nav-link block w-full text-center btn btn-green" data-page="register">Create Account</a>
            </div>
            
            <!-- Mobile User Links -->
            <div id="mobile-user-links" class="hidden px-5 pt-3 border-t border-gray-200 space-y-3">
                <a href="#" class="nav-link block w-full text-center px-4 py-2 rounded-lg font-medium bg-leaf-green text-white hover:bg-leaf-green-dark" data-page="dashboard">Dashboard</a>
                <a href="#" class="nav-link block w-full text-center text-gray-700 font-medium hover:bg-gray-100" data-page="request-product">Request Product</a>
                <a href="#" id="mobile-logout-btn" class="nav-link block w-full text-center text-gray-700 font-medium hover:bg-gray-100" data-page="home">Logout</a>
            </div>
        </div>
    </header>

    <!-- Main Content Area -->
    <div id="app-container" class="container mx-auto p-4 md:p-8">

        <!-- ===== PAGE: HOME ===== -->
        <main id="page-home" class="page-content">
            <div class="max-w-3xl mx-auto text-center">
                <!-- Search Box -->
                <div class="relative mb-8 w-full">
                    <input type="search" id="search-input" placeholder="Search product by name..." class="form-input !py-4 !pl-12 !pr-4 !rounded-full !shadow-lg">
                    <i class="fas fa-search text-gray-400 absolute top-1/2 left-5 transform -translate-y-1/2"></i>
                </div>
                <!-- Search Results -->
                <div id="search-results-container" class="hidden w-full max-w-3xl mx-auto bg-white rounded-lg shadow-lg -mt-6 mb-8 text-left">
                    <ul id="search-results-list" class="divide-y divide-gray-200 max-h-80 overflow-y-auto">
                        <!-- Search results injected here -->
                    </ul>
                </div>

                <!-- Barcode Scanner -->
                <h1 class="text-3xl md:text-4xl font-bold mb-4 text-dark-mode">Scan a Product Barcode</h1>
                <p class="text-lg text-gray-600 mb-8">
                    Use your camera to scan a product's barcode and instantly get its eco-score.
                </p>

                <div id="scanner-container" class="w-full max-w-md mx-auto bg-white p-6 rounded-2xl shadow-xl relative overflow-hidden">
                    <div class="leaf-pattern"></div>
                    <div id="reader" class="mx-auto bg-gray-200"></div>
                    <div id="scanner-status" class="mt-4 text-gray-600">Initializing scanner...</div>
                    <button id="start-scanner-btn" class="hidden btn btn-green mt-4 w-full">
                        <i class="fas fa-camera mr-2"></i> Start Scanner
                    </button>
                </div>
            </div>
        </main>

        <!-- ===== PAGE: LOGIN ===== -->
        <main id="page-login" class="page-content hidden">
            <div class="max-w-md mx-auto bg-white p-8 md:p-10 rounded-2xl shadow-2xl relative overflow-hidden">
                <div class="leaf-pattern"></div>
                <h2 class="text-3xl font-bold text-center mb-6 text-dark-mode">Welcome Back</h2>
                <form id="login-form" class="space-y-6">
                    <div>
                        <label for="login-email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                        <input type="email" id="login-email" class="form-input" placeholder="you@example.com" required>
                    </div>
                    <div>
                        <label for="login-password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                        <input type="password" id="login-password" class="form-input" placeholder="••••••••" required>
                    </div>
                    <button type="submit" class="btn btn-green w-full !py-3 !text-lg">Login</button>
                </form>
                <p class="mt-6 text-center text-sm text-gray-400">
    Don't have an account?
    <a href="#" id="showRegisterLink" class="font-medium text-eco-green hover:underline">
        Sign up
    </a>
</p>
            </div>
        </main>

        <!-- ===== PAGE: REGISTER ===== -->
        <main id="page-register" class="page-content hidden">
            <div class="max-w-md mx-auto bg-white p-8 md:p-10 rounded-2xl shadow-2xl relative overflow-hidden">
                <div class="leaf-pattern"></div>
                <h2 class="text-3xl font-bold text-center mb-6 text-dark-mode">Create Your Account</h2>
                <form id="register-form" class="space-y-6">
                    <div>
                        <label for="register-name" class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                        <input type="text" id="register-name" class="form-input" placeholder="Your Name" required>
                    </div>
                    <div>
                        <label for="register-email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                        <input type="email" id="register-email" class="form-input" placeholder="you@example.com" required>
                    </div>
                    <div>
                        <label for="register-password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                        <input type="password" id="register-password" class="form-input" placeholder="Minimum 8 characters" required minlength="8">
                    </div>
                    <button type="submit" class="btn btn-green w-full !py-3 !text-lg">Create Account</button>
                </form>
                <p class="mt-6 text-center text-sm text-gray-400">
        Already have an account?
        <a href="#" id="showLoginLink" class="font-medium text-eco-green hover:underline">
        Log in here
    </a>
</p>
            </div>
        </main>

        <!-- ===== PAGE: DASHBOARD ===== -->
        <main id="page-dashboard" class="page-content hidden">
            <h1 id="welcome-user" class="text-3xl md:text-4xl font-bold mb-8">Welcome!</h1>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- User Info Card -->
                <div class="md:col-span-1 bg-white p-6 rounded-2xl shadow-lg relative overflow-hidden">
                    <div class="leaf-pattern"></div>
                    <div class="relative z-10">
                        <h2 class="text-2xl font-bold mb-4">Your Profile</h2>
                        <div class="space-y-3">
                            <div>
                                <p class="text-sm font-medium text-gray-500">Name</p>
                                <p id="dash-user-name" class="text-lg font-semibold"></p>
                            </div>
                            <div>
                                <p class="text-sm font-medium text-gray-500">Email</p>
                                <p id="dash-user-email" class="text-lg font-semibold"></p>
                            </div>
                            <div>
                                <p class="text-sm font-medium text-gray-500">Eco Points</p>
                                <p id="dash-user-points" class="text-3xl font-bold text-leaf-green"></p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Actions Card -->
                <div class="md:col-span-2 bg-white p-6 rounded-2xl shadow-lg">
                    <h2 class="text-2xl font-bold mb-6">Actions</h2>
                    <div class="space-y-4">
                        <p class="text-gray-700">
                            Help our database grow! If you scan a product that isn't in our system, you can submit it here and earn 10 eco points.
                        </p>
                        <button class="nav-link btn btn-green" data-page="request-product">
                            <i class="fas fa-plus-circle mr-2"></i> Request a New Product
                        </button>
                    </div>
                </div>
            </div>
        </main>

        <!-- ===== PAGE: REQUEST PRODUCT ===== -->
        <main id="page-request-product" class="page-content hidden">
            <div class="max-w-2xl mx-auto bg-white p-8 md:p-10 rounded-2xl shadow-2xl relative overflow-hidden">
                <div class="leaf-pattern"></div>
                <h2 class="text-3xl font-bold text-center mb-6 text-dark-mode">Request a New Product</h2>
                <p class="text-center text-gray-600 mb-8">
                    Submit a product that's not in our database and earn <span class="font-bold text-leaf-green">10 points!</span>
                </p>
                <form id="request-form" class="space-y-6">
                    <div>
                        <label for="request-barcode" class="block text-sm font-medium text-gray-700 mb-1">Barcode</label>
                        <input type="text" id="request-barcode" name="barcode" class="form-input" placeholder="Scan or type barcode" required>
                    </div>
                    <div>
                        <label for="request-name" class="block text-sm font-medium text-gray-700 mb-1">Product Name</label>
                        <input type="text" id="request-name" name="name" class="form-input" placeholder="e.g., Organic Milk" required>
                    </div>
                    <div>
                        <label for="request-brandname" class="block text-sm font-medium text-gray-700 mb-1">Brand Name</label>
                        <input type="text" id="request-brandname" name="brandname" class="form-input" placeholder="e.g., EcoFarms" required>
                    </div>
                    <div>
                        <label for="request-image" class="block text-sm font-medium text-gray-700 mb-1">Product Image</label>
                        <input type="file" id="request-image" name="productImage" class="form-input file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-leaf-green file:text-white hover:file:bg-leaf-green-dark" accept="image/*" required>
                    </div>
                    <button type="submit" class="btn btn-green w-full !py-3 !text-lg">Submit Request</button>
                </form>
            </div>
        </main>

        <!-- ===== PAGE: ABOUT US ===== -->
        <main id="page-about" class="page-content hidden">
            <div class="max-w-4xl mx-auto bg-white p-8 md:p-10 rounded-2xl shadow-lg">
                <h1 class="text-3xl md:text-4xl font-bold text-center mb-8">About ecoScanAi</h1>
                <p class="text-lg text-gray-700 mb-6 leading-relaxed">
                    ecoScanAi was born from a shared passion for sustainability and technology. Our mission is to empower consumers to make informed, eco-friendly choices with a simple scan. We believe that small, everyday decisions can collectively create a massive positive impact on our planet.
                </p>
                <p class="text-lg text-gray-700 mb-10 leading-relaxed">
                    By providing transparent, easy-to-understand environmental scores for everyday products, we aim to bridge the information gap between consumers and sustainable practices.
                </p>

                <h2 class="text-2xl md:text-3xl font-bold text-center mb-8">The Developers</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-gray-50 p-6 rounded-lg shadow-sm text-center">
                        <h3 class="text-xl font-semibold mb-1">Razibul Hasan Badhon</h3>
                        <p class="text-leaf-green font-medium">Backend & Project Management</p>
                    </div>
                    <div class="bg-gray-50 p-6 rounded-lg shadow-sm text-center">
                        <h3 class="text-xl font-semibold mb-1">Abdullah Alif</h3>
                        <p class="text-leaf-green font-medium">Backend</p>
                    </div>
                    <div class="bg-gray-50 p-6 rounded-lg shadow-sm text-center">
                        <h3 class="text-xl font-semibold mb-1">Rifat Hassan</h3>
                        <p class="text-leaf-green font-medium">Frontend</p>
                    </div>
                    <div class="bg-gray-50 p-6 rounded-lg shadow-sm text-center">
                        <h3 class="text-xl font-semibold mb-1">Lubna Jahan Lipa</h3>
                        <p class="text-leaf-green font-medium">Database</p>
                    </div>
                </div>
            </div>
        </main>

        <!-- ===== PAGE: SCORING ===== -->
        <main id="page-scoring" class="page-content hidden">
            <div class="max-w-4xl mx-auto bg-white p-8 md:p-10 rounded-2xl shadow-lg">
                <h1 class="text-3xl md:text-4xl font-bold text-center mb-8">Our Scoring Algorithm</h1>
                <p class="text-lg text-gray-700 mb-8 leading-relaxed">
                    Transparency is a core value at ecoScanAi. Our eco-score is calculated based on three key factors: Packaging, Transportation, and Disposal. This provides a holistic view of a product's environmental impact from production to end-of-life.
                </p>

                <div class="bg-leaf-green text-white text-center p-6 rounded-lg shadow-lg mb-10">
                    <h2 class="text-2xl font-bold">Overall Score Formula</h2>
                    <p class="text-lg mt-2 font-mono">
                        (Packaging Score * 35%) + (Transport Score * 30%) + (Disposal Score * 35%)
                    </p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <!-- Packaging -->
                    <div>
                        <h3 class="text-2xl font-semibold mb-4 text-leaf-green flex items-center">
                            <i class="fas fa-box-open mr-3"></i> Packaging
                        </h3>
                        <ul class="space-y-2">
                            <li class="flex justify-between p-3 bg-gray-50 rounded"><span>None, Compostable Paper</span> <span class="font-bold">100</span></li>
                            <li class="flex justify-between p-3 bg-gray-100 rounded"><span>Glass, Paper, Cardboard</span> <span class="font-bold">80</span></li>
                            <li class="flex justify-between p-3 bg-gray-50 rounded"><span>Aluminum, Recyclable Plastic</span> <span class="font-bold">60</span></li>
                            <li class="flex justify-between p-3 bg-gray-100 rounded"><span>Plastic, Mixed Materials</span> <span class="font-bold">20</span></li>
                            <li class="flex justify-between p-3 bg-gray-50 rounded"><span>Unknown</span> <span class="font-bold">40</span></li>
                        </ul>
                    </div>
                    <!-- Transport -->
                    <div>
                        <h3 class="text-2xl font-semibold mb-4 text-leaf-green flex items-center">
                            <i class="fas fa-truck mr-3"></i> Transport
                        </h3>
                        <ul class="space-y-2">
                            <li class="flex justify-between p-3 bg-gray-50 rounded"><span>Local, Regional</span> <span class="font-bold">95</span></li>
                            <li class="flex justify-between p-3 bg-gray-100 rounded"><span>National</span> <span class="font-bold">70</span></li>
                            <li class="flex justify-between p-3 bg-gray-50 rounded"><span>International</span> <span class="font-bold">30</span></li>
                            <li class="flex justify-between p-3 bg-gray-100 rounded"><span>Unknown</span> <span class="font-bold">50</span></li>
                        </ul>
                    </div>
                    <!-- Disposal -->
                    <div>
                        <h3 class="text-2xl font-semibold mb-4 text-leaf-green flex items-center">
                            <i class="fas fa-recycle mr-3"></i> Disposal
                        </h3>
                        <ul class="space-y-2">
                            <li class="flex justify-between p-3 bg-gray-50 rounded"><span>Compostable, Reusable</span> <span class="font-bold">100</span></li>
                            <li class="flex justify-between p-3 bg-gray-100 rounded"><span>Recyclable</span> <span class="font-bold">85</span></li>
                            <li class="flex justify-between p-3 bg-gray-50 rounded"><span>Minimal Impact</span> <span class="font-bold">70</span></li>
                            <li class="flex justify-between p-3 bg-gray-100 rounded"><span>Landfill</span> <span class="font-bold">10</span></li>
                            <li class="flex justify-between p-3 bg-gray-50 rounded"><span>Unknown</span> <span class="font-bold">40</span></li>
                        </ul>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Footer -->
    <footer class="bg-dark-mode text-gray-300 mt-16">
        <div class="container mx-auto px-4 py-8 text-center">
            <p>&copy; 2025 ecoScanAi. All rights reserved.</p>
            <p class="text-sm text-gray-400 mt-1">Making sustainability simple.</p>
        </div>
    </footer>


    <!-- JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // === CONFIG ===
            const API_BASE_URL = "https://ecoscan-an-eco-friendly-product-scanner.onrender.com"; // IMPORTANT: Change this to your live backend URL
            let html5QrCode; // Scanner instance
            let isScannerRunning = false;
            
            // === STATE ===
            const state = {
                currentPage: 'home',
                loggedInUser: null,
                authToken: null,
            };

            // === SELECTORS ===
            const $ = (selector) => document.querySelector(selector);
            const $$ = (selector) => document.querySelectorAll(selector);

            // Page Selectors
            const pages = $$('.page-content');
            const appContainer = $('#app-container');

            // Header Selectors
            const appHeader = $('#app-header');
            const authLinks = $('#auth-links');
            const userLinks = $('#user-links');
            const mobileMenuBtn = $('#mobile-menu-btn');
            const mobileMenu = $('#mobile-menu');
            const mobileAuthLinks = $('#mobile-auth-links');
            const mobileUserLinks = $('#mobile-user-links');

            // Modal Selectors
            const loadingSpinner = $('#loading-spinner');
            const messageModal = $('#message-modal');
            const messageText = $('#message-text');
            const messageCloseBtn = $('#message-close-btn');

            // Product Modal Selectors
            const productModal = $('#product-modal');
            const productModalClose = $('#product-modal-close');

            // Form Selectors
            const loginForm = $('#login-form');
            const registerForm = $('#register-form');
            const requestForm = $('#request-form');
            
            // Home Page Selectors
            const startScannerBtn = $('#start-scanner-btn');
            const scannerStatus = $('#scanner-status');
            const reader = $('#reader');
            const searchInput = $('#search-input');
            const searchResultsContainer = $('#search-results-container');
            const searchResultsList = $('#search-results-list');

            // === UTILITY FUNCTIONS ===

            /**
             * Shows or hides the global loading spinner.
             * @param {boolean} show - True to show, false to hide.
             */
            function showLoading(show) {
                loadingSpinner.classList.toggle('hidden', !show);
            }

            /**
             * Shows a modal with a message.
             * @param {string} message - The message to display.
             * @param {boolean} [isError=false] - True to style as an error (e.g., red button).
             */
            function showMessage(message, isError = false) {
                messageText.textContent = message;
                messageCloseBtn.classList.toggle('btn-green', !isError);
                messageCloseBtn.classList.toggle('bg-red-500', isError);
                messageCloseBtn.classList.toggle('hover:bg-red-600', isError);
                messageModal.classList.remove('hidden');
            }

            /**
             * Navigates to a specific page.
             * @param {string} pageId - The ID of the page to show (e.g., 'home', 'login').
             */
            function navigate(pageId) {
                // Stop scanner if navigating away from home
                if (state.currentPage === 'home' && pageId !== 'home' && isScannerRunning) {
                    stopScanner();
                }
                
                // If navigating to home, ensure the "Start Scanner" button is visible
                if (pageId === 'home' && !isScannerRunning) {
                    scannerStatus.textContent = "Click 'Start Scanner' to begin.";
                    startScannerBtn.classList.remove('hidden');
                }

                pages.forEach(page => {
                    page.classList.toggle('hidden', page.id !== `page-${pageId}`);
                });
                state.currentPage = pageId;
                window.scrollTo(0, 0); // Scroll to top on page change
                mobileMenu.classList.add('hidden'); // Close mobile menu on nav
                
                // Page-specific render functions
                if (pageId === 'dashboard') renderDashboard();
            }

            /**
             * Updates the header to show/hide auth vs. user links.
             */
            function updateHeader() {
                const isLoggedIn = !!state.loggedInUser;
                authLinks.classList.toggle('hidden', isLoggedIn);
                userLinks.classList.toggle('hidden', !isLoggedIn);
                mobileAuthLinks.classList.toggle('hidden', isLoggedIn);
                mobileUserLinks.classList.toggle('hidden', !isLoggedIn);
            }
            
            /**
             * Saves auth token and user data to state and localStorage.
             * @param {string} token - The JWT access token.
             * @param {object} user - The user object.
             */
            function saveAuth(token, user) {
                state.authToken = token;
                state.loggedInUser = user;
                localStorage.setItem('authToken', token);
                localStorage.setItem('loggedInUser', JSON.stringify(user));
            }

            /**
             * Clears auth data from state and localStorage.
             */
            function clearAuth() {
                state.authToken = null;
                state.loggedInUser = null;
                localStorage.removeItem('authToken');
                localStorage.removeItem('loggedInUser');
                updateHeader();
            }

            // === SCORING LOGIC (from backend) ===
            function getPackagingScore(material) {
                switch (material) {
                    case "none": case "compostable_paper": return 100;
                    case "glass": case "paper": case "cardboard": return 80;
                    case "aluminum": case "recyclable_plastic": return 60;
                    case "plastic": case "mixed_materials": return 20;
                    default: return 40;
                }
            }
            function getTransportScore(location) {
                switch (location) {
                    case "local": case "regional": return 95;
                    case "national": return 70;
                    case "international": return 30;
                    default: return 50;
                }
            }
            function getDisposalScore(method) {
                switch (method) {
                    case "compostable": case "reusable": return 100;
                    case "recyclable": return 85;
                    case "minimal_impact": return 70;
                    case "landfill": return 10;
                    default: return 40;
                }
            }
            function getScoreRating(score) {
                if (score >= 85) return "Excellent";
                if (score >= 70) return "Good";
                if (score >= 50) return "Average";
                if (score >= 30) return "Poor";
                return "Very Poor";
            }

            // === RENDER FUNCTIONS ===

            /**
             * Renders the product modal with product data and alternatives.
             * @param {object} product - The main product object.
             * @param {object[]} alternatives - An array of alternative product objects.
             */
            /**
 * Renders the product modal with product data and alternatives.
* @param {object} data - The entire API response object from your Go backend
 */
/**
 * Renders the product modal with product data and alternatives.
 * @param {object} data - The entire API response object from your Go backend
 */
/**
 * Renders the product modal with product data and alternatives.
 * @param {object} data - The entire API response object from your Go backend
 */
function renderProductModal(data) {
    const product = data.product;
    const alternatives = data.alternatives || [];
    if (!product) return;

    // --- Helper function (Pure JavaScript) ---
    const $ = (selector) => document.getElementById(selector);

    // Calculate score breakdown
    const packScore = getPackagingScore(product.packaging_material);
    const transScore = getTransportScore(product.manufacturing_location);
    const dispScore = getDisposalScore(product.disposal_method);

    // --- Main Product Info ---
    $('product-img').src = product.image_url || 'https://placehold.co/400x400/eeeeee/cccccc?text=No+Image';
    $('product-name').textContent = product.name;
    $('product-brand').textContent = product.brand_name;
    $('product-barcode').textContent = product.barcode;

    // Main product price
    const priceEl = $('product-price');
    if (priceEl) {
        priceEl.textContent = `$${product.price.toFixed(2)}`;
    }

    // Main score
    $('product-score').textContent = data.score;
    $('product-score-rating').textContent = data.score_rating;

    // Score breakdown
    $('product-packaging').textContent = `${packScore}/100`;
    $('product-transport').textContent = `${transScore}/100`;
    $('product-disposal').textContent = `${dispScore}/100`;

    // --- Alternatives Section (The Fix) ---
    const altList = $('product-alternatives-list');
    const altContainer = $('product-alternatives-container');

    // 1. Clear the list of old alternatives
    altList.innerHTML = '';

    // 2. Clone the list to remove all old event listeners
    const newAltList = altList.cloneNode(false);
    altList.parentNode.replaceChild(newAltList, altList);

    if (alternatives && alternatives.length > 0) {
        // 3. Add all the new alternative cards
        alternatives.forEach(alt => {
            newAltList.innerHTML += `
<div class="flex-shrink-0 w-48 bg-gray-50 border border-gray-200 rounded-lg shadow-sm p-4 text-center cursor-pointer hover:bg-gray-100 transition-colors alt-card" data-barcode="${alt.barcode}">
 <img src="${alt.image_url || 'https://placehold.co/200x200/eeeeee/cccccc?text=No+Image'}" alt="${alt.name}" class="w-full h-24 object-cover rounded-md mb-3" />
 <h5 class="font-semibold text-sm">${alt.name}</h5>
 <p class="text-xs text-gray-500 mb-2">${alt.brand_name}</p>
 <div class="text-lg font-bold text-gray-800 mb-1">${alt.score}</div>
 <p class="text-md font-semibold text-green-600">$${alt.price.toFixed(2)}</p>
 </div>
 `;
        });

        // 4. Add ONE SINGLE click listener to the entire list
        newAltList.addEventListener('click', (e) => {
            const card = e.target.closest('.alt-card');
            if (card) {
                const barcode = card.dataset.barcode;
                
                // --- THIS IS THE LOGIC YOU ASKED FOR ---
                // 1. Close the current modal
                closeModal(); // Assumes you have a closeModal() function
                
                // 2. Fetch the new product using its barcode
                fetch(`https://ecoscan-an-eco-friendly-product-scanner.onrender.com/api/v1/products/barcode/${barcode}`)
                    .then(res => {
                        if (!res.ok) {
                            throw new Error('Product not found');
                        }
                        return res.json();
                    })
                    .then(productData => {
                        // 3. Open the modal again with the NEW data
                        renderProductModal(productData);
                    })
                    .catch(err => {
                        console.error("Error fetching alternative product:", err);
                        // You should probably show an error message to the user here
                    });
            }
        });

        altContainer.classList.remove('hidden');
    } else {
        altContainer.classList.add('hidden');
    }

    // --- Show the modal ---
    // (Assuming 'productModal' is a global variable holding the modal element)
    productModal.classList.remove('hidden');
    productModal.querySelector('.modal-content').classList.add('scale-100');
}

        function closeModal() {
    // This assumes your main modal element has the ID "productModal"
    const modal = $('productModal'); 
    
    if (modal) {
        modal.classList.add('hidden');
        
        // This resets the animation for the next time it opens
        const modalContent = modal.querySelector('.modal-content');
        if (modalContent) {
            modalContent.classList.remove('scale-100');
        }
    }
}
            /**
             * Renders the user's dashboard with their info.
             */
            function renderDashboard() {
                if (!state.loggedInUser) {
                    showMessage("You must be logged in to view the dashboard.", true);
                    navigate('login');
                    return;
                }
                $('#welcome-user').textContent = `Welcome, ${state.loggedInUser.name}!`;
                $('#dash-user-name').textContent = state.loggedInUser.name;
                $('#dash-user-email').textContent = state.loggedInUser.email;
                $('#dash-user-points').textContent = state.loggedInUser.points;
            }
            
            /**
             * Renders search results in the dropdown.
             * @param {object[]} products - Array of product objects.
             */
            function renderSearchResults(products) {
                searchResultsList.innerHTML = ''; // Clear old results
                if (products.length === 0) {
                    searchResultsList.innerHTML = `<li class="p-4 text-gray-500">No products found.</li>`;
                    searchResultsContainer.classList.remove('hidden');
                    return;
                }
                
                products.forEach(product => {
                    const li = document.createElement('li');
                    li.className = 'p-4 hover:bg-gray-100 cursor-pointer flex items-center space-x-4';
                    li.innerHTML = `
                        <img src="${product.image_url || 'https://placehold.co/50x50/eeeeee/cccccc?text=N/A'}" class="w-12 h-12 rounded-md object-cover">
                        <div>
                            <p class="font-semibold text-dark-mode">${product.name}</p>
                            <p class="text-sm text-gray-500">${product.brand_name}</p>
                        </div>
                        <span class="ml-auto font-bold text-leaf-green">${product.score}</span>
                    `;
                    li.addEventListener('click', () => {
                        fetchProductByBarcode(product.barcode);
                        searchResultsContainer.classList.add('hidden');
                        searchInput.value = '';
                    });
                    searchResultsList.appendChild(li);
                });
                searchResultsContainer.classList.remove('hidden');
            }

            // === API CALLS ===

            /**
             * Fetches a product by its barcode.
             * @param {string} barcode - The barcode to look up.
             * @param {boolean} [stopScan=true] - Whether to stop the scanner after fetch.
             */
            async function fetchProductByBarcode(barcode, stopScan = true) {
                if (stopScan && isScannerRunning) {
                    stopScanner();
                    scannerStatus.textContent = "Scanner stopped. Processing...";
                }
                showLoading(true);
                try {
                    const response = await fetch(`${API_BASE_URL}/api/v1/products/barcode/${barcode}`);
                    
                    if (response.status === 404) {
                        scannerStatus.textContent = "Product not found.";
                        showMessage("Product not found. Would you like to request to add it?");
                        // If logged in, pre-fill request form
                        if (state.loggedInUser) {
                            navigate('request-product');
                            $('#request-barcode').value = barcode;
                        }
                        return;
                    }
                    
                    if (!response.ok) {
                        throw new Error(`Server error: ${response.statusText}`);
                    }
                    
                    // NEW WAY (Example)
const data = await response.json();
renderProductModal(data); // <-- ADJUSTED: Pass the whole response object
                    scannerStatus.textContent = `Found: ${data.product.name}`;

                } catch (error) {
                    console.error("Error fetching product:", error);
                    showMessage(`Error: ${error.message}`, true);
                    if (isScannerRunning) scannerStatus.textContent = "Error. Try again.";
                } finally {
                    showLoading(false);
                    // Optionally restart scanner
                    // if (!stopScan && !isScannerRunning) startScanner();
                }
            }

            /**
             * Searches for products by name.
             * @param {string} query - The search query.
             */
            async function searchProducts(query) {
                if (query.length < 2) {
                    searchResultsContainer.classList.add('hidden');
                    return;
                }
                // No loading spinner for search for a faster feel
                try {
                    const response = await fetch(`${API_BASE_URL}/api/v1/products/search?q=${encodeURIComponent(query)}`);
                    if (!response.ok) throw new Error('Search failed');
                    
                    const products = await response.json();
                    renderSearchResults(products || []);
                } catch (error) {
                    console.error("Error searching:", error);
                    searchResultsList.innerHTML = `<li class="p-4 text-red-500">Search error.</li>`;
                    searchResultsContainer.classList.remove('hidden');
                }
            }

            // === BARCODE SCANNER LOGIC ===

            const onScanSuccess = (decodedText, decodedResult) => {
    console.log("Scan result:", decodedText, decodedResult);

    // Show the raw result
    scannerStatus.textContent = `Found barcode: ${decodedText}`;

    // Pass it to your backend lookup
    fetchProductByBarcode(decodedText);
};



            const onScanFailure = (error) => {
                // This will fire continuously, don't log it unless debugging
                // console.warn(`Scan failure: ${error}`);
                scannerStatus.textContent = "Scanning... Align barcode in the box.";
            };

            function startScanner() {
    if (isScannerRunning) return;

    Html5Qrcode.getCameras().then(cameras => {
        if (cameras && cameras.length) {
            console.log("Available cameras:", cameras);

            // Prefer wide/ultra-wide if available
            let preferredCam = cameras.find(c =>
                c.label.toLowerCase().includes("wide")
            );

            // If no wide, prefer back camera
            if (!preferredCam) {
                preferredCam = cameras.find(c =>
                    c.label.toLowerCase().includes("back")
                );
            }

            // Fallback to the first camera
            const cameraId = preferredCam?.id || cameras[0].id;

            html5QrCode = new Html5Qrcode("reader");
            html5QrCode.start(
                cameraId,
                {
                    fps: 10,
                    qrbox: (viewfinderWidth, viewfinderHeight) => {
                        const minEdge = Math.min(viewfinderWidth, viewfinderHeight);
                        const qrboxSize = Math.floor(minEdge * 0.8);
                        return { width: qrboxSize, height: qrboxSize * 0.5 };
                    }
                },
                onScanSuccess,
                onScanFailure
            )
            .then(() => {
                isScannerRunning = true;
                startScannerBtn.classList.add('hidden');
                scannerStatus.textContent = "Scanning...";
                reader.style.borderColor = "#4CAF50";
            })
            .catch(err => {
                console.error("Failed to start scanner:", err);
                scannerStatus.textContent = `Error: ${err}. Try refreshing.`;
                reader.style.borderColor = "#ef4444";
            });
        } else {
            scannerStatus.textContent = "No cameras found on this device.";
        }
    }).catch(err => {
        console.error("Error getting cameras:", err);
        scannerStatus.textContent = "Camera permission denied or error.";
        startScannerBtn.classList.remove('hidden');
    });
}

            function stopScanner() {
                if (!html5QrCode || !isScannerRunning) return;
                
                html5QrCode.stop()
                    .then(() => {
                        console.log("Scanner stopped.");
                        isScannerRunning = false;
                        scannerStatus.textContent = "Scanner stopped.";
                        startScannerBtn.classList.remove('hidden');
                        reader.style.borderColor = "#4CAF50";
                        // Clear the reader box
                        reader.innerHTML = '';
                    })
                    .catch(err => {
                        console.error("Failed to stop scanner:", err);
                    });
            }
            
            // === EVENT LISTENERS ===

            // Navigation Links
            appHeader.addEventListener('click', (e) => {
                const navLink = e.target.closest('.nav-link');
                if (navLink) {
                    e.preventDefault();
                    const page = navLink.dataset.page;
                    if (page) navigate(page);
                }
            });

            // Logout Buttons
            $('#logout-btn').addEventListener('click', (e) => {
                e.preventDefault();
                clearAuth();
                navigate('home');
            });
            $('#mobile-logout-btn').addEventListener('click', (e) => {
                e.preventDefault();
                clearAuth();
                navigate('home');
            });

            // Mobile Menu Toggle
            mobileMenuBtn.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });

            // Close Message Modal
            messageCloseBtn.addEventListener('click', () => {
                messageModal.classList.add('hidden');
            });
            
            // Close Product Modal
            productModalClose.addEventListener('click', () => {
                productModal.classList.add('hidden');
                productModal.querySelector('.modal-content').classList.add('scale-95');
                // Restart scanner if we are on the home page
                if (state.currentPage === 'home' && !isScannerRunning) {
                    startScanner();
                }
            });
            
            // Scanner Start Button
            startScannerBtn.addEventListener('click', startScanner);

            // Login Form
            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                showLoading(true);
                const email = $('#login-email').value;
                const password = $('#login-password').value;

                try {
                    const response = await fetch(`${API_BASE_URL}/api/v1/auth/login`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email, password })
                    });
                    
                    const data = await response.json();
                    if (!response.ok) throw new Error(data.message || 'Login failed');

                    saveAuth(data.access_token, data.user);
                    updateHeader();
                    navigate('dashboard');
                    loginForm.reset();

                } catch (error) {
                    showMessage(error.message, true);
                } finally {
                    showLoading(false);
                }
            });

            // Register Form
            registerForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                showLoading(true);
                const name = $('#register-name').value;
                const email = $('#register-email').value;
                const password = $('#register-password').value;

                try {
                    const response = await fetch(`${API_BASE_URL}/api/v1/auth/register`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ name, email, password })
                    });
                    
                    const data = await response.json();
                    if (!response.ok) throw new Error(data.message || 'Registration failed');

                    showMessage("Account created successfully! Please log in.");
                    navigate('login');
                    registerForm.reset();

                } catch (error) {
                    showMessage(error.message, true);
                } finally {
                    showLoading(false);
                }
            });

            // Request Product Form
            requestForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                if (!state.authToken) {
                    showMessage("You must be logged in to submit a request.", true);
                    navigate('login');
                    return;
                }
                
                showLoading(true);
                const formData = new FormData(requestForm);
                
                try {
                    const response = await fetch(`${API_BASE_URL}/api/v1/products/request`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${state.authToken}`
                        },
                        body: formData
                    });
                    
                    const data = await response.json();
                    if (!response.ok) throw new Error(data.message || 'Request failed');
                    
                    // Update user points locally
                    state.loggedInUser.points += 10;
                    saveAuth(state.authToken, state.loggedInUser);
                    
                    showMessage("Request submitted successfully! You've earned 10 points.");
                    requestForm.reset();
                    navigate('dashboard');

                } catch (error) {
                    if (error.message.includes('Token has expired') || error.message.includes('Invalid token')) {
                        showMessage("Your session has expired. Please log in again.", true);
                        clearAuth();
                        navigate('login');
                    } else {
                        showMessage(error.message, true);
                    }
                } finally {
                    showLoading(false);
                }
            });
            
            // Search Input
            let searchTimeout;
            searchInput.addEventListener('input', () => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    searchProducts(searchInput.value);
                }, 300); // Debounce
            });
            // Hide search results when clicking outside
            document.addEventListener('click', (e) => {
                if (!searchResultsContainer.contains(e.target) && e.target !== searchInput) {
                    searchResultsContainer.classList.add('hidden');
                }
            });

            // === NAVIGATION FOR AUTH LINKS ===
            // This finds the links you gave IDs to in Step 1
            const showRegisterLink = document.getElementById('showRegisterLink');
            const showLoginLink = document.getElementById('showLoginLink');

            if (showRegisterLink) {
                showRegisterLink.addEventListener('click', (e) => {
                    e.preventDefault(); // Prevents the page from jumping
                    navigate('register'); // Calls your function to show the register page
                });
            }

            if (showLoginLink) {
                showLoginLink.addEventListener('click', (e) => {
                    e.preventDefault(); // Prevents the page from jumping
                    navigate('login'); // Calls your function to show the login page
                });
            }

            // === SEARCH LOGIC ===
            // (Your existing search logic code probably starts here)

            // === INITIALIZATION ===
            function initApp() {
                // Check for saved auth token
                const token = localStorage.getItem('authToken');
                const user = localStorage.getItem('loggedInUser');
                
                if (token && user) {
                    try {
                        const parsedUser = JSON.parse(user);
                        // Here you might want to validate the token against a /me endpoint
                        // For now, we'll trust the stored data
                        saveAuth(token, parsedUser);
                    } catch (e) {
                        clearAuth();
                    }
                }
                
                updateHeader();
                navigate('home'); // Start on the home page
            }
            
            initApp();
        });
    </script>
</body>
</html>

